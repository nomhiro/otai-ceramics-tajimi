---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const products = await getCollection('products');
  return products.map((product) => ({
    params: { slug: product.id },
    props: { product },
  }));
}

const { product } = Astro.props;
const { Content } = await render(product);

const seriesInfo: Record<string, { name: string; description: string }> = {
  nirin: { name: '二輪花', description: '白釉に二輪花の絵付け' },
  tori: { name: '鳥絵', description: '鳥をモチーフにした絵付け' },
  raku: { name: '楽々絵', description: '楽しい雰囲気の絵付け' },
  roku: { name: '波絵', description: '波をモチーフにした絵付け' },
  bara: { name: 'ばら絵', description: 'バラをモチーフにした絵付け' },
  sono: { name: '動物絵', description: '動物をモチーフにした絵付け' },
  some: { name: '染付', description: '呉須による藍色の絵付け' },
  akae: { name: '赤絵', description: '赤色を基調にした絵付け' },
};
---

<BaseLayout title={product.data.title} description={`${product.data.title} - 小田井窯の${seriesInfo[product.data.series]?.name || ''}シリーズ`}>
  <section class="py-16 md:py-24">
    <div class="max-w-6xl mx-auto px-4">
      <!-- Breadcrumb -->
      <nav class="text-sm mb-8">
        <ol class="flex items-center gap-2 text-gray-500">
          <li><a href="/" class="hover:text-gosu-blue">ホーム</a></li>
          <li>/</li>
          <li><a href="/products/" class="hover:text-gosu-blue">商品一覧</a></li>
          <li>/</li>
          <li class="text-sumi">{product.data.title}</li>
        </ol>
      </nav>

      <div class="grid md:grid-cols-2 gap-12">
        <!-- Product Images -->
        <div>
          <div class="aspect-square bg-gray-100 mb-4">
            <img
              src={product.data.images[0]}
              alt={product.data.title}
              class="w-full h-full object-cover"
              id="main-image"
            />
          </div>
          {product.data.images.length > 1 && (
            <div class="grid grid-cols-4 gap-2">
              {product.data.images.map((image: string, index: number) => (
                <button
                  class="aspect-square bg-gray-100 border-2 border-transparent hover:border-gosu-blue transition-colors thumbnail-btn"
                  data-image={image}
                >
                  <img
                    src={image}
                    alt={`${product.data.title} ${index + 1}`}
                    class="w-full h-full object-cover"
                  />
                </button>
              ))}
            </div>
          )}
        </div>

        <!-- Product Info -->
        <div>
          <span class="text-sm text-gosu-blue font-medium">
            {seriesInfo[product.data.series]?.name || product.data.series}シリーズ
          </span>
          <h1 class="font-serif text-2xl md:text-3xl text-sumi mt-2 mb-4">
            {product.data.title}
          </h1>
          <p class="text-2xl text-gosu-blue font-medium mb-6">
            ¥{product.data.price.toLocaleString()}<span class="text-sm text-gray-500">（税込）</span>
          </p>

          <div class="border-t border-b border-gray-200 py-4 mb-6">
            <dl class="space-y-2">
              <div class="flex">
                <dt class="w-24 text-gray-500">サイズ</dt>
                <dd>{product.data.size}</dd>
              </div>
              <div class="flex">
                <dt class="w-24 text-gray-500">在庫</dt>
                <dd>
                  {product.data.inStock ? (
                    <span class="text-yuu-green">在庫あり</span>
                  ) : (
                    <span class="text-akae-red">在庫なし</span>
                  )}
                </dd>
              </div>
            </dl>
          </div>

          <div class="prose prose-sm text-gray-700 mb-8">
            <Content />
          </div>

          <a href="/contact/" class="btn-primary inline-block">
            この商品について問い合わせる
          </a>

          <p class="text-xs text-gray-500 mt-4">
            ※ 商品はすべて手描きです。お届けする製品が見本と若干異なることもございます。
          </p>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  const mainImage = document.getElementById('main-image') as HTMLImageElement;
  const thumbnails = document.querySelectorAll('.thumbnail-btn');

  thumbnails.forEach(thumb => {
    thumb.addEventListener('click', () => {
      const newSrc = thumb.getAttribute('data-image');
      if (newSrc && mainImage) {
        mainImage.src = newSrc;
      }
    });
  });
</script>
