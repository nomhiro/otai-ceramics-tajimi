---
/**
 * Products Page (English)
 * Product catalog with filtering
 */
import BaseLayoutEn from '../../../layouts/BaseLayoutEn.astro';
import SectionTitle from '../../../components/SectionTitle.astro';
import { getCollection } from 'astro:content';

const products = await getCollection('products');

const series = [
  { slug: 'all', name: 'All', nameJa: 'すべて' },
  { slug: 'nirin', name: 'Nirin-ka', nameJa: '二輪花' },
  { slug: 'tori', name: 'Tori-e', nameJa: '鳥絵' },
  { slug: 'raku', name: 'Raku-raku-e', nameJa: '楽々絵' },
  { slug: 'roku', name: 'Roku-e', nameJa: 'ろく絵' },
  { slug: 'bara', name: 'Bara-e', nameJa: 'ばら絵' },
  { slug: 'sono', name: 'Sono-e', nameJa: '園絵' },
  { slug: 'some', name: 'Sometsuke', nameJa: '染付' },
  { slug: 'akae', name: 'Aka-e', nameJa: '赤絵' },
];
---

<BaseLayoutEn title="Products" description="Browse our collection of handcrafted Mino ware ceramics. Tableware, sake vessels, and decorative pieces.">
  <!-- Hero -->
  <section class="bg-ai text-hakuji section-padding-sm">
    <div class="container-ma text-center">
      <h1 class="hero-title font-serif text-3xl md:text-4xl lg:text-5xl mb-6 tracking-wider">Products</h1>
      <p class="hero-subtitle text-hakuji/80 text-lg">Browse our collection of handcrafted ceramics</p>
    </div>
  </section>

  <!-- Filters -->
  <section class="py-8 bg-hakuji sticky top-16 z-40 shadow-sm">
    <div class="container-ma">
      <div class="flex flex-wrap justify-center gap-3">
        {series.map((s) => (
          <button
            data-series={s.slug}
            class="filter-btn px-4 py-2 text-sm font-serif rounded-full border border-ai/30 text-sumi hover:bg-ai hover:text-hakuji transition-colors data-[active=true]:bg-ai data-[active=true]:text-hakuji"
          >
            {s.name}
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Products Grid -->
  <section class="section-padding">
    <div class="container-ma">
      {products.length > 0 ? (
        <div class="products-grid grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 md:gap-8">
          {products.map((product) => (
            <a
              href={`/en/products/${product.slug}/`}
              class="product-card group"
              data-series={product.data.series}
            >
              <div class="aspect-square bg-kinari rounded-lg overflow-hidden mb-4 shadow-sm group-hover:shadow-md transition-shadow">
                {product.data.images?.[0] ? (
                  <img
                    src={product.data.images[0]}
                    alt={product.data.title}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                  />
                ) : (
                  <div class="w-full h-full flex items-center justify-center text-sumi/30">
                    <span class="font-serif text-4xl">器</span>
                  </div>
                )}
              </div>
              <h3 class="font-serif text-lg text-sumi group-hover:text-ai transition-colors mb-1">
                {product.data.title}
              </h3>
              <p class="text-sm text-sumi/60 mb-2">{product.data.series}</p>
              <p class="text-ai font-medium">
                ¥{product.data.price?.toLocaleString()}
              </p>
            </a>
          ))}
        </div>
      ) : (
        <div class="text-center py-20">
          <p class="text-sumi/60 text-lg mb-6">Products coming soon.</p>
          <p class="text-sumi/60">
            Please <a href="/en/contact/" class="text-ai hover:underline">contact us</a> for product inquiries.
          </p>
        </div>
      )}
    </div>
  </section>

  <!-- Custom Orders CTA -->
  <section class="section-padding bg-ai text-hakuji">
    <div class="max-w-4xl mx-auto px-6 text-center">
      <SectionTitle title="Custom Orders" subtitle="オリジナル制作" align="center" />
      <p class="text-hakuji/80 text-lg mb-8">
        Looking for custom ceramics with your logo or design?<br />
        We accept orders for restaurants, hotels, and corporate gifts.
      </p>
      <a href="/en/custom/" class="btn-secondary inline-block">
        Learn About Custom Orders
      </a>
    </div>
  </section>

  <!-- Sake Vessels CTA -->
  <section class="section-padding">
    <div class="max-w-4xl mx-auto px-6 text-center">
      <SectionTitle title="Sake Vessels" subtitle="徳利・盃" />
      <p class="text-sumi/80 text-lg mb-8">
        Explore our collection of tokkuri (sake bottles) and sakazuki (sake cups).
      </p>
      <a href="/en/products/sake/" class="btn-primary inline-block">
        View Sake Vessels
      </a>
    </div>
  </section>
</BaseLayoutEn>

<!-- Filtering and animations -->
<script>
  import { gsap, prefersReducedMotion } from '../../../utils/animations';

  // Filter functionality
  const filterBtns = document.querySelectorAll('.filter-btn');
  const productCards = document.querySelectorAll('.product-card');

  // Get initial filter from URL
  const urlParams = new URLSearchParams(window.location.search);
  const initialSeries = urlParams.get('series') || 'all';

  // Set initial active state
  filterBtns.forEach((btn) => {
    if (btn.getAttribute('data-series') === initialSeries) {
      btn.setAttribute('data-active', 'true');
    }
  });

  // Apply initial filter
  filterProducts(initialSeries);

  filterBtns.forEach((btn) => {
    btn.addEventListener('click', () => {
      const series = btn.getAttribute('data-series') || 'all';

      // Update active state
      filterBtns.forEach((b) => b.setAttribute('data-active', 'false'));
      btn.setAttribute('data-active', 'true');

      // Update URL
      const url = new URL(window.location.href);
      if (series === 'all') {
        url.searchParams.delete('series');
      } else {
        url.searchParams.set('series', series);
      }
      history.replaceState(null, '', url.toString());

      // Filter products
      filterProducts(series);
    });
  });

  function filterProducts(series: string) {
    productCards.forEach((card) => {
      const cardSeries = card.getAttribute('data-series');
      const show = series === 'all' || cardSeries === series;

      if (show) {
        (card as HTMLElement).style.display = '';
      } else {
        (card as HTMLElement).style.display = 'none';
      }
    });

    // Animate visible cards
    if (!prefersReducedMotion()) {
      const visibleCards = Array.from(productCards).filter(
        (card) => (card as HTMLElement).style.display !== 'none'
      );
      gsap.from(visibleCards, {
        y: 30,
        opacity: 0,
        duration: 0.4,
        stagger: 0.05,
        ease: 'power2.out',
      });
    }
  }

  // Initial animations
  window.addEventListener('gsap:ready', () => {
    if (prefersReducedMotion()) return;

    const heroTl = gsap.timeline({ defaults: { ease: 'power3.out' } });
    heroTl
      .from('.hero-title', { y: 50, opacity: 0, duration: 0.8 })
      .from('.hero-subtitle', { y: 30, opacity: 0, duration: 0.6 }, '-=0.4');
  });
</script>
