# SPEC.md - 仕様書

小田井窯ウェブサイトリニューアルの仕様書です。
本ドキュメントは **仕様駆動開発（SPEC-Driven Development）** のマスター仕様として機能します。

---

## 仕様駆動開発とは

### 定義

仕様駆動開発は、実装前に仕様（SPEC）を明確に定義し、その仕様に基づいて開発・テストを行う手法です。

### 目的

1. **要件の明確化**: 実装前に「何を作るか」を明確にする
2. **品質の向上**: 受け入れ条件を事前に定義することでテスト可能性を高める
3. **コミュニケーション**: ステークホルダー間の認識齟齬を防ぐ
4. **変更管理**: 仕様変更の影響範囲を把握しやすくする

### ワークフロー

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   要件確認   │ → │  SPEC作成   │ → │ SPECレビュー │
└─────────────┘    └─────────────┘    └─────────────┘
                                              │
                                              ↓
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  SPEC更新   │ ← │   テスト    │ ← │    実装     │
└─────────────┘    └─────────────┘    └─────────────┘
```

---

## SPECテンプレート

新機能を追加する際は、以下のテンプレートを使用してください。

```markdown
## SPEC-XXX: 機能名

### 目的
この機能が必要な理由を記述

### 関連ユーザーストーリー
- US-XX: ユーザーストーリーの引用

### 機能要件
- [ ] 要件1
- [ ] 要件2

### 非機能要件
- [ ] パフォーマンス要件
- [ ] セキュリティ要件

### 受け入れ条件
- [ ] 検証可能な条件1
- [ ] 検証可能な条件2

### テスト計画
- ユニットテスト: 対象と方針
- E2Eテスト: シナリオ

### 優先度
Must / Should / Nice

### ステータス
Draft / Review / Approved / Implemented / Verified
```

---

## 機能仕様一覧

### 優先度マトリクス

```
              低工数                      高工数
         ┌─────────────────┬─────────────────┐
         │                 │                 │
  Must   │ • SPEC-001      │ • SPEC-003      │
         │ • SPEC-002      │ • SPEC-004      │
         │                 │ • SPEC-005      │
         │                 │                 │
         ├─────────────────┼─────────────────┤
         │                 │                 │
  Should │ • SPEC-007      │ • SPEC-006      │
         │                 │                 │
         │                 │                 │
         ├─────────────────┼─────────────────┤
         │                 │                 │
  Nice   │ • SPEC-009      │ • SPEC-008      │
         │                 │                 │
         │                 │                 │
         └─────────────────┴─────────────────┘
```

---

## SPEC-001: SSL/HTTPS対応

### 目的
セキュリティ強化とSEO評価向上のため、サイト全体をHTTPS化する。

### 関連ユーザーストーリー
- 全ユーザー: 安全にサイトを閲覧・利用したい

### 機能要件
- [ ] 全ページをHTTPSで配信
- [ ] HTTPからHTTPSへの自動リダイレクト（301）
- [ ] 混在コンテンツ（Mixed Content）の排除

### 非機能要件
- [ ] TLS 1.2以上をサポート
- [ ] 有効なSSL証明書を使用（Let's Encrypt可）

### 受け入れ条件
- [ ] `https://www.otai.co.jp/` でアクセス可能
- [ ] `http://` アクセス時に `https://` へリダイレクトされる
- [ ] ブラウザで「保護された通信」と表示される
- [ ] Lighthouse Security監査でエラーなし

### テスト計画
- E2Eテスト: 各ページへのHTTPS接続確認
- セキュリティテスト: SSL Labs評価A以上

### 優先度
**Must**

### ステータス
Draft

---

## SPEC-002: UTF-8文字コード対応

### 目的
文字化けを解消し、多言語対応の基盤を整える。

### 関連ユーザーストーリー
- US-1: 美濃焼・小田井窯について知りたい（文字化けなく閲覧）

### 機能要件
- [ ] 全HTMLファイルをUTF-8エンコーディングで配信
- [ ] メタタグに `<meta charset="UTF-8">` を設定
- [ ] データベースをUTF-8（utf8mb4）で構築

### 非機能要件
- [ ] 既存コンテンツの文字化けなし移行

### 受け入れ条件
- [ ] 日本語が正しく表示される（漢字、ひらがな、カタカナ）
- [ ] 特殊文字（〜、①、㈱等）が正しく表示される
- [ ] フォーム送信時に日本語が文字化けしない

### テスト計画
- ユニットテスト: 文字エンコーディング変換処理
- E2Eテスト: 各ページの日本語表示確認

### 優先度
**Must**

### ステータス
Draft

---

## SPEC-003: レスポンシブデザイン

### 目的
スマートフォン・タブレットでの閲覧体験を向上させる。

### 関連ユーザーストーリー
- US-1〜US-8: 全ての一般消費者向け機能

### 機能要件
- [ ] モバイルファーストのレイアウト設計
- [ ] ブレークポイント: 320px / 768px / 1024px / 1280px
- [ ] タップターゲットサイズ: 44px × 44px以上
- [ ] 画像の自動リサイズ（srcset/sizes使用）

### 非機能要件
- [ ] Core Web Vitals基準達成
  - LCP: 2.5秒以内
  - FID: 100ms以内
  - CLS: 0.1以下

### 受け入れ条件
- [ ] iPhone SE (375px) で全コンテンツが閲覧可能
- [ ] iPad (768px) で適切なレイアウト
- [ ] デスクトップ (1280px以上) で最適表示
- [ ] 横スクロールが発生しない

### テスト計画
- E2Eテスト: Playwright でマルチデバイス表示確認
- パフォーマンステスト: Lighthouse モバイルスコア90以上

### 優先度
**Must**

### ステータス
Draft

---

## SPEC-004: 商品カタログ

### 目的
8つの商品シリーズと酒器を分かりやすく閲覧できるようにする。

### 関連ユーザーストーリー
- US-2: シリーズ別に商品を閲覧したい
- US-3: 商品詳細（写真・サイズ・価格）を確認したい
- US-5: 酒器（徳利・盃）を選びたい

### 機能要件
- [ ] シリーズ別商品一覧ページ（8シリーズ + 酒器）
- [ ] 商品詳細ページ
  - 複数画像表示（ギャラリー）
  - 商品名、価格（税込）、サイズ
  - 在庫状況
  - カートに追加ボタン
- [ ] 商品フィルタリング（シリーズ、価格帯）
- [ ] 商品検索機能

### 非機能要件
- [ ] 商品画像: WebP形式、遅延読み込み
- [ ] SEO: 商品ごとの構造化データ（Schema.org/Product）

### 受け入れ条件
- [ ] 全8シリーズのページが存在する
- [ ] 各商品に最低1枚の画像がある
- [ ] 価格が税込で表示される
- [ ] 在庫状況が表示される

### テスト計画
- ユニットテスト: 価格計算、在庫判定ロジック
- E2Eテスト: 商品一覧→詳細→カート追加フロー

### 優先度
**Must**

### ステータス
Draft

---

## SPEC-005: お問い合わせフォーム

### 目的
CGIスクリプトを廃止し、安全なお問い合わせフォームを提供する。

### 関連ユーザーストーリー
- US-7: 問い合わせをしたい
- US-9: 卸売・大量注文を相談したい
- US-10: オリジナル製品を発注したい（OEM）

### 機能要件
- [ ] 入力フィールド
  - お名前（必須）
  - メールアドレス（必須）
  - 電話番号（任意）
  - お問い合わせ種別（選択）
  - お問い合わせ内容（必須）
- [ ] 入力バリデーション（クライアント/サーバー両方）
- [ ] 確認画面表示
- [ ] 送信完了画面
- [ ] 自動返信メール
- [ ] 管理者通知メール

### 非機能要件
- [ ] CSRF対策
- [ ] スパム対策（reCAPTCHA v3）
- [ ] 送信データの暗号化

### 受け入れ条件
- [ ] 必須項目が空の場合、エラーメッセージが表示される
- [ ] 無効なメールアドレス形式でエラーが表示される
- [ ] 送信成功時に確認メールが届く
- [ ] 管理者に通知メールが届く

### テスト計画
- ユニットテスト: バリデーションロジック
- E2Eテスト: フォーム入力→送信→確認フロー
- セキュリティテスト: CSRF、XSS対策確認

### 優先度
**Must**

### ステータス
Draft

---

## SPEC-006: ECカート機能

### 目的
商品購入フローを提供する。

### 関連ユーザーストーリー
- US-4: オンラインで注文したい
- US-6: ギフト用に購入したい

### 機能要件
- [ ] カートに追加/削除
- [ ] 数量変更
- [ ] 小計・合計表示（税込）
- [ ] 送料計算（地域別、10,000円以上で無料）
- [ ] 支払い方法選択（代引、銀行振込、郵便振替）
- [ ] 配送先入力
- [ ] 注文確認
- [ ] 注文完了（注文番号発行）

### 非機能要件
- [ ] セッション管理（カート内容保持）
- [ ] 在庫チェック（注文確定時）
- [ ] SSL暗号化

### 受け入れ条件
- [ ] 商品をカートに追加できる
- [ ] カート内容を変更できる
- [ ] 正しい合計金額が表示される
- [ ] 注文完了後に確認メールが届く

### テスト計画
- ユニットテスト: 金額計算、送料計算
- E2Eテスト: 商品選択→カート→決済フロー
- 統合テスト: 在庫連携

### 優先度
**Should**

### ステータス
Draft

---

## SPEC-007: Googleマップ埋め込み

### 目的
店舗・窯元へのアクセス情報を視覚的に提供する。

### 関連ユーザーストーリー
- US-8: 実店舗・窯元を訪問したい

### 機能要件
- [ ] 会社概要ページにGoogleマップを埋め込み
- [ ] マーカーで所在地を表示
- [ ] 「Google マップで開く」リンク

### 非機能要件
- [ ] 遅延読み込み（パフォーマンス対策）
- [ ] レスポンシブ対応

### 受け入れ条件
- [ ] 地図が正しく表示される
- [ ] 所在地（多治見市三笠町2-10）にマーカーがある
- [ ] モバイルでも適切なサイズで表示される

### テスト計画
- E2Eテスト: 地図表示確認

### 優先度
**Should**

### ステータス
Draft

---

## SPEC-008: 多言語対応（英語）

### 目的
インバウンド観光客への対応。

### 関連ユーザーストーリー
- （新規）外国人観光客として、英語で商品情報を閲覧したい

### 機能要件
- [ ] 言語切り替えUI
- [ ] 主要ページの英語版
  - トップページ
  - 美濃焼について
  - 商品一覧
  - お問い合わせ

### 非機能要件
- [ ] SEO: hreflang属性の設定
- [ ] URL: `/en/` プレフィックスまたはサブドメイン

### 受け入れ条件
- [ ] 英語版ページが存在する
- [ ] 言語切り替えが機能する
- [ ] 日本語と英語で同じ構造を維持

### テスト計画
- E2Eテスト: 言語切り替えフロー

### 優先度
**Nice**

### ステータス
Draft

---

## SPEC-009: Instagram連携

### 目的
作品・制作風景の発信とSNSマーケティング。

### 関連ユーザーストーリー
- （新規）訪問者として、小田井窯の最新情報をSNSで確認したい

### 機能要件
- [ ] Instagramフィード埋め込み（トップページ）
- [ ] Instagramアカウントへのリンク
- [ ] シェアボタン（商品ページ）

### 非機能要件
- [ ] 遅延読み込み
- [ ] プライバシー対応（GDPR/個人情報保護）

### 受け入れ条件
- [ ] Instagramの投稿が表示される
- [ ] リンクをクリックするとInstagramアプリ/サイトが開く

### テスト計画
- E2Eテスト: フィード表示確認

### 優先度
**Nice**

### ステータス
Draft

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 担当 |
|------|-----------|----------|------|
| 2025-12-15 | 1.0.0 | 初版作成 | - |
